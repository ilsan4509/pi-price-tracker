<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>For Jayson</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background-color: #4B0082; /* 전체 배경색을 FBB44A로 설정 */
      font-family: Arial, sans-serif;
    }
    .header {
      position: relative;
      padding: 20px;
      text-align: center;
      color: white;
    }
    .header h1 {
      margin: 0;
      font-size: 3em;
      display: inline-flex;
      align-items: center;
    }
    .header h1 img {
      width: 60px; /* 이미지 크기는 필요에 따라 조정 */
      height: auto;
      margin-right: 10px;
    }
    .from-left {
      position: absolute;
      top: 20px;
      left: 20px;
      font-size: 1em;
    }
    .from-right {
      position: absolute;
      top: 20px;
      right: 20px;
      font-size: 1em;
    }
    /* 중앙 콘텐츠 컨테이너: 흰색 배경으로 좌우 FBB44A가 보이도록 */
    .main-container {
      background-color: #fff;
      max-width: 800px;
      margin: 20px auto; 
      padding: 20px;
    }
    .section {
      text-align: center;
      margin-top: 50px;
      font-size: 2em;
      line-height: 1;
    }
    .price {
      text-align: center;
      margin-top: 30px;
      font-size: 2em;
      line-height: 1.5;
    }
    .input-container {
      text-align: center;
      margin-top: 30px;
      font-size: 1.5em;
    }
    .input-container input {
      font-size: 1em;
      padding: 5px;
      width: 100px;
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>
      <img src="https://i.namu.wiki/i/hamH2roeH-scce8dH9WUtQYq3fvc8xy0hGi4XsGtc-ZAnVjb7FbbrdMS16dObpDZezav4WSjIimzWBUJ6Pm_5eSgxXGcVtpTB3VBfxmwnXoBUXEiRjTfASqjdQqZbZHQ1piBNPad8fZ7Y-8M_O7wvQ.svg" alt="Pi Logo">
      Pi
    </h1>
    <div class="from-right">From Jayden</div>
  </div>
  
  <!-- 메인 콘텐츠를 감싸는 중앙 컨테이너 -->
  <div class="main-container">
    <div class="section">현재가</div>
    <div class="price" id="price">Loading...</div>

    <div class="section">가격</div>
    <div class="input-container">
      <label for="piQuantity">Pi 개수:</label>
      <input type="number" id="piQuantity" value="0" min="0" step="any">
    </div>
    
    <div class="price" id="total">Total: Loading...</div>
  </div>
  
  <script>
    async function fetchPrice() {
      try {
        // 1. OKX API에서 PI-USDT 티커 정보를 가져옵니다.
        const response = await fetch('https://www.okx.com/api/v5/market/ticker?instId=PI-USDT');
        const data = await response.json();
        if (data && data.data && data.data.length > 0) {
          const usdPrice = parseFloat(data.data[0].last);
          
          // 2. 무료 환율 API (open.er-api.com)에서 USD 기준 환율 정보를 가져옵니다.
          const rateResponse = await fetch('https://open.er-api.com/v6/latest/USD');
          const rateData = await rateResponse.json();
          
          if (rateData && rateData.result === "success" && rateData.rates) {
            const gbpRate = rateData.rates.GBP;
            const krwRate = rateData.rates.KRW;
            if (gbpRate && krwRate) {
              const gbpPrice = usdPrice * gbpRate;
              const krwPrice = usdPrice * krwRate;
              
              // 천 단위 쉼표 및 소수점 자리수 포맷팅
              const formattedUsd = usdPrice.toLocaleString("en-US", {minimumFractionDigits: 4, maximumFractionDigits: 4});
              const formattedGbp = gbpPrice.toLocaleString("en-GB", {minimumFractionDigits: 4, maximumFractionDigits: 4});
              const formattedKrw = krwPrice.toLocaleString("ko-KR", {maximumFractionDigits: 0});
              
              // 1 PI 당 가격 표시
              document.getElementById('price').innerHTML = 
                "PI Price (USD): $" + formattedUsd + "<br>" +
                "PI Price (GBP): £" + formattedGbp + "<br>" +
                "PI Price (KRW): ₩" + formattedKrw;
              
              // 3. 인풋 박스에 입력된 Pi 개수에 따른 총 가격 계산
              const quantity = parseFloat(document.getElementById('piQuantity').value) || 0;
              const totalUsd = usdPrice * quantity;
              const totalGbp = gbpPrice * quantity;
              const totalKrw = krwPrice * quantity;
              
              const formattedTotalUsd = totalUsd.toLocaleString("en-US", {minimumFractionDigits: 4, maximumFractionDigits: 4});
              const formattedTotalGbp = totalGbp.toLocaleString("en-GB", {minimumFractionDigits: 4, maximumFractionDigits: 4});
              const formattedTotalKrw = totalKrw.toLocaleString("ko-KR", {maximumFractionDigits: 0});
              
              document.getElementById('total').innerHTML = 
                "Total Value (USD): $" + formattedTotalUsd + "<br>" +
                "Total Value (GBP): £" + formattedTotalGbp + "<br>" +
                "Total Value (KRW): ₩" + formattedTotalKrw;
            } else {
              document.getElementById('price').innerText = "Error fetching exchange rates";
              document.getElementById('total').innerText = "Error calculating total";
            }
          } else {
            document.getElementById('price').innerText = "Error fetching exchange rates";
            document.getElementById('total').innerText = "Error calculating total";
          }
        } else {
          document.getElementById('price').innerText = "Price not available";
          document.getElementById('total').innerText = "Price not available";
        }
      } catch (error) {
        console.error("Error fetching data:", error);
        document.getElementById('price').innerText = "Error fetching price data";
        document.getElementById('total').innerText = "Error calculating total";
      }
    }
    // 페이지 로드 후 즉시 가격 업데이트 및 1초마다 갱신
    fetchPrice();
    setInterval(fetchPrice, 1000);
    
    // 인풋 박스 값 변경 시에도 총 가격을 업데이트
    document.getElementById('piQuantity').addEventListener('input', fetchPrice);
  </script>
</body>
</html>
